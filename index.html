<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edytor Dialogów</title>
<style>
body {
    font-family: sans-serif;
    margin: 15px;
    max-width: 600px;
    margin-inline: auto;
}
h1 {
    font-size: 18px;
    text-align: center;
    margin-bottom: 15px;
}
input, button, textarea {
    font-size: 14px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 3px;
}
button {
    background: #f0f0f0;
    cursor: pointer;
    border: 1px solid #999;
}
button:hover {
    background: #e0e0e0;
}
.dialog {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
    align-items: center;
}
input[type="text"] {
    flex: 1;
}
input[type="number"] {
    width: 60px;
}
button.rm {
    width: 30px;
    padding: 6px;
}
.controls {
    display: flex;
    gap: 8px;
    margin: 15px 0;
    flex-wrap: wrap;
}
.controls button {
    flex: 1;
    min-width: 100px;
}
.color-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 10px;
}
input[type="color"] {
    width: 50px;
    height: 35px;
    cursor: pointer;
}
textarea {
    width: 100%;
    height: 120px;
    font-family: monospace;
    font-size: 13px;
    margin-top: 10px;
}
.preview {
    background: #f5f5f5;
    border: 1px solid #ddd;
    padding: 15px;
    margin-top: 10px;
    border-radius: 3px;
    display: none;
}
.preview.active {
    display: block;
}
.preview-box {
    background: rgba(0,0,0,0.85);
    padding: 15px;
    border-radius: 3px;
    font-size: 16px;
    text-align: center;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
</head>
<body>
<h1>Edytor Dialogów</h1>

<div id="list"></div>

<button onclick="add()" style="width: 100%; margin-bottom: 10px;">+ Dodaj</button>

<div class="color-row">
    <label>Kolor:</label>
    <input type="color" id="color" value="#ff0000">
</div>

<div class="controls">
    <button onclick="gen()">Generuj</button>
    <button onclick="test()">Testuj</button>
    <button onclick="dl()">Pobierz</button>
</div>

<div id="preview" class="preview">
    <div id="box" class="preview-box"></div>
</div>

<textarea id="out" readonly></textarea>

<script>
let d = [];
let i = 0;

function add() {
    d.push({ t: 'Nowy dialog', dur: 1.5 });
    show();
}

function rm(x) {
    d.splice(x, 1);
    show();
}

function show() {
    document.getElementById('list').innerHTML = d.map((v, x) => `
        <div class="dialog">
            <input type="text" value="${v.t}" onchange="d[${x}].t=this.value">
            <input type="number" value="${v.dur}" step="0.1" onchange="d[${x}].dur=+this.value">
            <button class="rm" onclick="rm(${x})">✕</button>
        </div>
    `).join('');
}

function gen() {
    let c = document.getElementById('color').value;
    let r = parseInt(c.substr(1,2), 16) / 255;
    let g = parseInt(c.substr(3,2), 16) / 255;
    let b = parseInt(c.substr(5,2), 16) / 255;
    let t = `INITIAL_DELAY 0\nDURATION 1.5\nCOLOR ${r.toFixed(2)},${g.toFixed(2)},${b.toFixed(2)}\nBILLBOARD true\n---\n`;
    d.forEach(v => {
        t += v.t + ` | duration=${v.dur}\n`;
    });
    document.getElementById('out').value = t;
}

function test() {
    if (!d.length) return alert('Dodaj dialog!');
    i = 0;
    document.getElementById('preview').classList.add('active');
    nx();
}

function nx() {
    if (i >= d.length) {
        document.getElementById('preview').classList.remove('active');
        return;
    }
    let v = d[i];
    let b = document.getElementById('box');
    b.textContent = v.t;
    b.style.color = document.getElementById('color').value;
    i++;
    setTimeout(nx, v.dur * 1000);
}

function dl() {
    gen();
    let a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([document.getElementById('out').value], {type: 'text/plain'}));
    a.download = 'dialogs.txt';
    a.click();
}

show();
</script>
</body>
</html>
